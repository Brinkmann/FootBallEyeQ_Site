Perfect, that makes sense. Here's a comprehensive prompt for the coding AI that starts with discovery before fixing:

---

## TASK: Fix Session Plan Data Persistence Issue

### Problem Statement
A Vercel-hosted website with Firebase database contains a catalogue of football/soccer drills. Coaches can log in and allocate drills to weekly session plans. However, when a coach logs out and logs back in, all allocated drills disappear and the session plans are empty again.

### Phase 1: Discovery & Analysis (MANDATORY FIRST STEP)

Before making any changes, analyse the codebase and answer the following:

1. **Authentication System**
   - Which authentication method is being used? (Firebase Auth, NextAuth, custom, etc.)
   - How is the current user ID/identifier retrieved?
   - Where is authentication state managed?

2. **Database Structure**
   - Is Firebase Firestore or Realtime Database being used?
   - Examine the current database schema for session plans
   - Are session plans currently tied to individual user IDs or stored globally?
   - Show the current data structure being used

3. **Data Flow Analysis**
   - When a drill is allocated to a session plan, trace where this data goes:
     - Is it only stored in component state (React state, Zustand, Context)?
     - Is it stored in localStorage/sessionStorage?
     - Is it being written to Firebase?
   - Check browser console and Network tab for Firebase write operations
   - Check Firebase console to see if data appears there

4. **Data Retrieval Analysis**
   - On login/page load, how is session plan data fetched?
   - Are there any Firebase read operations happening?
   - Check for any authentication state dependencies in data fetching

5. **Framework & Structure**
   - Confirm whether Next.js or React is being used
   - Identify state management approach
   - List relevant files and components involved

**Output a detailed report of findings before proceeding.**

### Phase 2: Root Cause Identification

Based on Phase 1 findings, identify the specific cause of data loss. Common issues include:
- Session plans only stored in local state (not persisted to Firebase)
- Data written to Firebase but not associated with user ID
- Data fetching not triggered on login
- Authentication state not properly awaited before data fetch
- Incorrect Firebase security rules preventing reads

### Phase 3: Implementation Fix

Implement a solution that ensures:

1. **User-Specific Data Storage**
   - Each coach's session plans are stored under their unique user ID
   - Database structure like: `sessionPlans/{userId}/{sessionId}/{drillAllocations}`

2. **Proper Data Persistence**
   - When a drill is allocated, immediately write to Firebase
   - Include error handling and confirmation of successful write

3. **Reliable Data Retrieval**
   - On authentication state change, fetch the logged-in coach's session plans
   - Properly handle loading states
   - Cache data appropriately to avoid unnecessary refetches

4. **Firebase Security Rules**
   - Ensure coaches can only read/write their own session plans
   - Provide updated security rules if needed

### Phase 4: Testing Checklist

Verify the fix works by confirming:
- [ ] Drill allocation writes to Firebase (visible in Firebase console)
- [ ] Data is stored under correct user ID
- [ ] After logout and login, session plans reload correctly
- [ ] Different coaches see only their own session plans
- [ ] No console errors during login/logout/allocation

### Deliverables

1. Discovery report with current implementation details
2. Identified root cause explanation
3. Modified code files with clear comments
4. Updated Firebase security rules (if applicable)
5. Step-by-step testing instructions

---

Does this prompt cover everything you need, or would you like me to adjust anything?